<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ashish Computer Services — Admin</title>
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body data-role="admin">
  <header class="site-header">
    <div class="brand">
      <div style="width:44px;height:44px;background:linear-gradient(90deg,#2563eb,#00b4d8);border-radius:8px"></div>
      <div>
        <h1>Ashish Computer Services</h1>
        <div class="tagline">Warranty & Service — Admin</div>
      </div>
    </div>
    <div class="header-actions">
      <a href="/admin/index.html" class="btn btn-outline">Public View</a>
      <!-- logout button -->
      <button id="logoutBtn" class="btn btn-outline">Logout</button>
    </div>
  </header>

  <main class="layout">
    <section class="content" style="width:100%">
      <div class="card">
        <h3>Admin Dashboard</h3>
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px">
          <button id="adminRegisterProductBtn" class="btn btn-primary">Register Product</button>
          <button id="adminCreateTicketBtn" class="btn btn-primary">Create Ticket</button>
          <button id="exportBtn" class="btn">Export CSV</button>
        </div>

        <div id="adminTableWrap" style="max-height:320px;overflow:auto">
          <table id="adminTable" style="width:100%;border-collapse:collapse">
            <thead><tr><th>ID</th><th>Cust</th><th>Item</th><th>Product</th><th>Status</th><th>Actions</th></tr></thead>
            <tbody id="adminTableBody"></tbody>
          </table>
        </div>
      </div>

      <div id="adminProductsWrap" class="card" style="margin-top:12px"></div>
    </section>
  </main>

  <!-- Register Product modal -->
  <div id="adminRegisterProductModal" class="modal hidden">
    <div class="modal-panel small">
      <button class="close" id="closeRegisterProduct">&times;</button>
      <h3>Register Product</h3>
      <input id="reg_itemName" placeholder="Item name" />
      <input id="reg_serial" placeholder="Serial" style="margin-top:8px" />
      <input id="reg_billNo" placeholder="Bill No." style="margin-top:8px" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="reg_purchaseDate" type="date" />
        <input id="reg_warrantyMonths" type="number" placeholder="Warranty months" />
      </div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="regSaveBtn" class="btn btn-primary">Save</button>
        <button id="regCancelBtn" class="btn btn-outline">Cancel</button>
      </div>
      <div id="regMsg" class="muted" style="margin-top:6px"></div>
    </div>
  </div>

  <!-- Create Ticket modal -->
  <div id="adminCreateTicketModal" class="modal hidden">
    <div class="modal-panel small">
      <button class="close" id="closeCreateTicket">&times;</button>
      <h3>Create Ticket</h3>
      <select id="ticket_productSelect"></select>
      <input id="ticket_custName" placeholder="Customer name" style="margin-top:8px" />
      <input id="ticket_custPhone" placeholder="Phone" style="margin-top:8px" />
      <textarea id="ticket_problem" placeholder="Problem" style="margin-top:8px"></textarea>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="ticketSaveBtn" class="btn btn-primary">Create</button>
        <button id="ticketCancelBtn" class="btn btn-outline">Cancel</button>
      </div>
      <div id="ticketMsg" class="muted" style="margin-top:6px"></div>
    </div>
  </div>

  <div id="modal" class="modal hidden"><div class="modal-panel"><button class="close" id="closeModal">&times;</button><div id="modalBody"></div></div></div>

  <footer class="footer"><small>V0.0.2 — Admin</small></footer>

  <script src="/js/app.js"></script>
  <script>
    (function(){
      // Protect admin page: redirect to login if not admin
      if(!isAdmin()){ location.href = 'admin-login.html'; return; }

      // Wire logout
      document.getElementById('logoutBtn').addEventListener('click', ()=>{
        adminLogoutFn();
        location.href = 'index.html';
      });

      // Wire admin actions to functions provided by app.js
      document.getElementById('adminRegisterProductBtn').addEventListener('click', openRegisterProductModal);
      document.getElementById('adminCreateTicketBtn').addEventListener('click', openCreateTicketModal);
      document.getElementById('exportBtn').addEventListener('click', exportCSV);

      document.getElementById('closeRegisterProduct').addEventListener('click', ()=>document.getElementById('adminRegisterProductModal').classList.add('hidden'));
      document.getElementById('regSaveBtn').addEventListener('click', onRegisterProduct);
      document.getElementById('regCancelBtn').addEventListener('click', ()=>document.getElementById('adminRegisterProductModal').classList.add('hidden'));

      document.getElementById('closeCreateTicket').addEventListener('click', ()=>document.getElementById('adminCreateTicketModal').classList.add('hidden'));
      document.getElementById('ticketSaveBtn').addEventListener('click', onCreateTicket);
      document.getElementById('ticketCancelBtn').addEventListener('click', ()=>document.getElementById('adminCreateTicketModal').classList.add('hidden'));

      // modal close
      document.getElementById('closeModal').addEventListener('click', ()=>document.getElementById('modal').classList.add('hidden'));

      // Render admin view (defined in app.js)
      // renderAdmin() will populate tickets table and products list
      if(typeof renderAdmin === 'function') renderAdmin();
      else console.warn('renderAdmin missing in app.js');
    })();
  </script>
</body>
</html>
