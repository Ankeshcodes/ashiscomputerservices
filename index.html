<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ashish Computer Services — Warranty Tracker</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="site-header">
    <div class="brand">
      <svg class="logo" viewBox="0 0 48 48" aria-hidden>
        <defs><linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#2563EB"/><stop offset="1" stop-color="#00B4D8"/></linearGradient></defs>
        <rect rx="8" width="48" height="48" fill="url(#g1)"></rect>
        <path d="M12 30 L20 18 L28 30 Z" fill="#fff"></path>
      </svg>
      <div>
        <h1>Ashish Computer Services</h1>
        <div class="tagline">Warranty & Service Tracker</div>
      </div>
    </div>

    <nav class="nav">
      <ul>
        <li class="nav-item active">Products</li>
        <li class="nav-item" id="nav-check">Warranty Check</li>
        <li class="nav-item" id="nav-status">Warranty Status</li>
        <li class="nav-item" id="nav-contact">Contact Us</li>
      </ul>
    </nav>

    <div class="header-actions">
      <button id="adminBtn" class="btn btn-primary">Admin Login</button>
    </div>
  </header>

  <main class="layout">
    <aside class="sidebar">
      <div class="card">
        <h3>Quick Menu</h3>
        <ul class="side-menu">
          <li onclick="showSection('check')">Warranty Check</li>
          <li onclick="showSection('list')">Warranty Status (Admin only)</li>
          <li onclick="showSection('export')">Export CSV</li>
        </ul>
      </div>

      <div class="card contact-card">
        <h4>Contact</h4>
        <p><strong>Ashish Computer Services</strong><br>Garhwa, Jharkhand<br>Phone: 8521450594</p>
      </div>

      <div id="adminPanelLink" class="card" style="display:none">
        <h4>Admin</h4>
        <button class="btn btn-primary" onclick="showSection('adminDashboard')">Open Admin Dashboard</button>
      </div>
    </aside>

    <section class="content">
      <div class="hero card">
        <div class="hero-left">
          <h2>Track your product</h2>
          <p>Enter Ticket ID to check current status. (Public search — Ticket ID only)</p>

          <div class="track">
            <input id="quickTicketId" placeholder="Ticket ID (e.g. T-...)" />
            <button id="quickFind" class="btn">Search Ticket</button>
            <button id="statusOnlyBtn" class="btn btn-outline" onclick="showSection('list')">Admin: View All Status</button>
          </div>
        </div>

        <div class="hero-right">
          <div class="stat">
            <div class="stat-number" id="totalTickets">0</div>
            <div class="stat-label">Total Tickets</div>
          </div>
          <div class="stat">
            <div class="stat-number" id="inServiceCount">0</div>
            <div class="stat-label">In Service</div>
          </div>
        </div>
      </div>

      <div class="app-panels">
        <!-- Public: Warranty Check -->
        <section class="card panel" id="checkPanel">
          <h3>Warranty Check</h3>
          <div style="margin-bottom:12px; display:flex; gap:8px; align-items:center;">
            <input id="checkProduct" placeholder="Product name (required)" style="width:40%;padding:10px;border-radius:8px;border:1px solid #e6eef8" />
            <input id="checkSerial" placeholder="Serial No. (required)" style="width:30%;padding:10px;border-radius:8px;border:1px solid #e6eef8" />
            <button id="checkBtn" class="btn">Check</button>
          </div>
          <div id="checkResult" class="muted">Enter product name and serial number, then click Check.</div>
        </section>

        <!-- Admin-only list -->
        <section class="card panel" id="listPanel">
          <h3>Tickets / Warranty Status (Admin)</h3>
          <div class="controls">
            <input id="searchInput" placeholder="Search by Ticket ID / Customer / Item" />
            <select id="statusFilter">
              <option value="All">All Status</option>
              <option>Received</option>
              <option>Sent to Company</option>
              <option>In Service</option>
              <option>Service Complete</option>
              <option>Rejected</option>
              <option>Closed</option>
              <option>Returned</option>
            </select>
            <select id="sortBy">
              <option value="newest">Newest</option>
              <option value="oldest">Oldest</option>
            </select>
            <button id="exportBtn" class="btn">Export CSV</button>
          </div>

          <ul id="ticketList" class="ticket-list"></ul>
          <div id="emptyMsg" class="muted">Login as admin to view the full ticket list.</div>
        </section>

        <!-- Admin Dashboard -->
        <section class="card panel" id="adminDashboard" style="display:none">
          <h3>Admin Dashboard</h3>

          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px">
            <button class="btn btn-primary" id="adminRegisterProductBtn">Register Product</button>
            <button class="btn btn-primary" id="adminCreateTicketBtn">Create Ticket</button>
            <input id="adminSearch" placeholder="Filter tickets (ID/Customer/Item)" style="padding:8px;border-radius:8px;border:1px solid #e6eef8"/>
            <select id="adminStatusFilter" style="padding:8px;border-radius:8px;border:1px solid #e6eef8">
              <option value="All">All Status</option>
              <option>Received</option>
              <option>Sent to Company</option>
              <option>In Service</option>
              <option>Service Complete</option>
              <option>Rejected</option>
              <option>Closed</option>
              <option>Returned</option>
            </select>
          </div>

          <div id="adminTableWrap" style="overflow:auto;max-height:280px">
            <table id="adminTable" style="width:100%;border-collapse:collapse">
              <thead>
                <tr style="text-align:left;border-bottom:1px solid #eee">
                  <th style="padding:8px">ID</th>
                  <th>Customer</th>
                  <th>Item</th>
                  <th>Serial / Product</th>
                  <th>Status</th>
                  <th>Received</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="adminTableBody"></tbody>
            </table>
          </div>

          <!-- Products list container (rendered by JS) -->
          <div id="adminProductsWrap" style="margin-top:12px"></div>
        </section>
      </div>
    </section>
  </main>

  <!-- Ticket modal (view & admin edit actions inside) -->
  <div id="modal" class="modal hidden">
    <div class="modal-panel">
      <button class="close" id="closeModal">&times;</button>
      <div id="modalBody"></div>
    </div>
  </div>

  <!-- Admin modal (login-only) -->
  <div id="adminModal" class="modal hidden">
    <div class="modal-panel small">
      <button class="close" id="closeAdmin">&times;</button>
      <h3 id="adminModalTitle">Admin Login</h3>

      <div id="adminControls" class="form">
        <div style="margin-bottom:8px">
          <input id="adminUser" placeholder="Username" />
        </div>
        <div style="margin-bottom:8px">
          <input id="adminPass" type="password" placeholder="Password" />
        </div>

        <div class="row actions" style="margin-top:6px">
          <button id="adminSubmit" class="btn btn-primary">Login</button>
          <button id="adminLogout" class="btn btn-outline" style="display:none">Logout</button>
        </div>

        <div id="adminMsg" class="muted small" style="margin-top:8px"></div>
      </div>
    </div>
  </div>

  <!-- Register Product modal (admin-only) -->
  <div id="adminRegisterProductModal" class="modal hidden">
    <div class="modal-panel small">
      <button class="close" id="closeRegisterProduct">&times;</button>
      <h3 id="registerProductTitle">Register Product (Generates Product ID)</h3>
      <div class="form" style="margin-top:8px">
        <input id="reg_itemName" placeholder="Item name (required)" />
        <input id="reg_serial" placeholder="Serial No. (optional)" style="margin-top:8px" />
        <input id="reg_model" placeholder="Model (optional)" style="margin-top:8px" />
        <input id="reg_billNo" placeholder="Bill No. / Invoice No. (optional)" style="margin-top:8px" />
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="reg_purchaseDate" type="date" style="flex:1;padding:8px;border-radius:8px;border:1px solid #e6eef8" />
          <input id="reg_warrantyMonths" type="number" min="0" placeholder="Warranty (months)" style="width:160px;padding:8px;border-radius:8px;border:1px solid #e6eef8" />
        </div>

        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="regSaveBtn" class="btn btn-primary">Register Product (Generate ID)</button>
          <button id="regCancelBtn" class="btn btn-outline">Cancel</button>
        </div>

        <div id="regMsg" class="muted small" style="margin-top:8px"></div>
      </div>
    </div>
  </div>

  <!-- Create Ticket modal (admin-only) -->
  <div id="adminCreateTicketModal" class="modal hidden">
    <div class="modal-panel small">
      <button class="close" id="closeCreateTicket">&times;</button>
      <h3 id="createTicketTitle">Create Ticket (Attach to Product ID)</h3>
      <div class="form" style="margin-top:8px">
        <select id="ticket_productSelect"></select>
        <input id="ticket_custName" placeholder="Customer name (required)" style="margin-top:8px" />
        <input id="ticket_custPhone" placeholder="Phone (optional)" style="margin-top:8px" />
        <select id="ticket_priority" style="margin-top:8px;padding:8px;border-radius:8px">
          <option value="Normal">Normal</option><option value="High">High</option>
        </select>
        <textarea id="ticket_problem" placeholder="Problem description" style="margin-top:8px"></textarea>

        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="ticketSaveBtn" class="btn btn-primary">Create Ticket</button>
          <button id="ticketCancelBtn" class="btn btn-outline">Cancel</button>
        </div>

        <div id="ticketMsg" class="muted small" style="margin-top:8px"></div>
      </div>
    </div>
  </div>

  <footer class="footer">
    <small>V0.0.1 — Local browser tracker for Ashish Computer Services</small>
  </footer>

  <!-- DIAGNOSTIC: do not keep this permanently -->
<script>
try {
  alert('INLINE TEST: page loaded — starting diagnostics');

  // list of important element IDs your app expects
  const ids = [
    'quickTicketId','quickFind','statusOnlyBtn',
    'checkProduct','checkSerial','checkBtn','checkResult',
    'regSaveBtn','regCancelBtn','reg_itemName','reg_serial',
    'ticketSaveBtn','ticketCancelBtn','ticket_productSelect',
    'adminSubmit','adminBtn','closeModal','modal','modalBody'
  ];

  const missing = ids.filter(id => !document.getElementById(id));
  if(missing.length) {
    alert('MISSING ELEMENT IDS:\\n' + missing.join(',\\n'));
  } else {
    alert('All required element IDs are PRESENT');
  }

  // Now attempt to load external app.js and detect load/error
  const s = document.createElement('script');
  s.src = 'app.js';
  s.onload = () => {
    alert('EXTERNAL app.js LOADED successfully');
    // quick runtime smoke-check (safe)
    try {
      if (typeof window.__app_test_marker === 'undefined') {
        // define marker inside app.js if loaded OK (optional)
        // not required, this is just a check that code can run
      }
      alert('Runtime OK — app.js executed (no immediate exceptions)');
    } catch(e){
      alert('Runtime exception after loading app.js: ' + (e && e.message || e));
    }
  };
  s.onerror = () => {
    alert('ERROR: app.js failed to load (404 or blocked). Check filename/path & case-sensitivity.');
  };
  document.body.appendChild(s);
} catch(err){
  alert('DIAGNOSTIC SCRIPT ERROR: ' + (err && err.message || err));
}
</script>
</body>
</html>
