<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ashish Computer Services — Warranty Tracker (Public)</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body data-role="public">
  <header class="site-header">
    <div class="brand">
      <div style="width:44px;height:44px;background:linear-gradient(90deg,#2563eb,#00b4d8);border-radius:8px"></div>
      <div>
        <h1>Ashish Computer Services</h1>
        <div class="tagline">Warranty & Service Tracker</div>
      </div>
    </div>
    <div class="header-actions">
      <a href="admin.html" class="btn btn-outline">Admin Login</a>
    </div>
  </header>

  <main class="layout">
    <aside class="sidebar">
      <div class="card">
        <h3>Quick Menu</h3>
        <ul class="side-menu">
          <li onclick="document.getElementById('checkPanel').scrollIntoView()">Warranty Check</li>
          <li onclick="alert('For ticket status please enter Ticket ID in the tracker above.')">Warranty Status</li>
          <li onclick="exportCSV()">Export CSV</li>
        </ul>
      </div>

      <div class="card contact-card">
        <h4>Contact</h4>
        <p><strong>Ashish Computer Services</strong><br>Garhwa, Jharkhand<br>Phone: 8521450594</p>
      </div>
    </aside>

    <section class="content">
      <div class="hero card">
        <div>
          <h2>Track your product</h2>
          <p>Enter Ticket ID to check current status. (Public search — Ticket ID only)</p>
          <div class="track">
            <input id="quickTicketId" placeholder="Ticket ID (e.g. T-...)" />
            <button id="quickFind" class="btn">Search Ticket</button>
          </div>
        </div>

        <div class="hero-right">
          <div class="stat"><div class="stat-number" id="totalTickets">0</div><div class="stat-label">Total Tickets</div></div>
          <div class="stat"><div class="stat-number" id="inServiceCount">0</div><div class="stat-label">In Service</div></div>
        </div>
      </div>

      <div class="app-panels">
        <section class="card panel" id="checkPanel">
          <h3>Warranty Check</h3>
          <div style="display:flex;gap:8px;align-items:center">
            <input id="checkProduct" placeholder="Product name (required)" />
            <input id="checkSerial" placeholder="Serial No. (required)" />
            <button id="checkBtn" class="btn">Check</button>
          </div>
          <div id="checkResult" class="muted" style="margin-top:10px">Enter product and serial then click Check.</div>
        </section>
      </div>
    </section>
  </main>

  <div id="modal" class="modal hidden">
    <div class="modal-panel"><button class="close" id="closeModal">&times;</button><div id="modalBody"></div></div>
  </div>

  <footer class="footer"><small>V0.0.1 — Ashish Computer Services</small></footer>

  <script src="app.js"></script>
  <script>
    // Public page initialization
    (function(){
      const role = document.body.dataset.role;
      if(role !== 'public') return;
      // wire buttons
      document.getElementById('quickFind').addEventListener('click', () => {
        const q = (document.getElementById('quickTicketId').value||'').trim();
        if(!q) return alert('Enter Ticket ID');
        const t = getAllTickets().find(x => x.id.toLowerCase()===q.toLowerCase());
        if(!t) return alert('Ticket not found');
        openPublicTicketModal(t);
      });
      document.getElementById('checkBtn').addEventListener('click', () => {
        const p = (document.getElementById('checkProduct').value||'').trim();
        const s = (document.getElementById('checkSerial').value||'').trim();
        if(!p||!s){ document.getElementById('checkResult').textContent='Enter both product and serial.'; return; }
        doWarrantyCheckPublic(p,s);
      });
      document.getElementById('closeModal').addEventListener('click', ()=>document.getElementById('modal').classList.add('hidden'));
      // header stats
      renderPublicStats();
    })();

    // Public modal open (read-only)
    function openPublicTicketModal(t){
      const prod = findProduct(t.productId) || {};
      const w = warrantyInfoForProduct(prod);
      const warrantyText = !w.endDate ? 'Warranty info not available' : (w.onWarranty ? `On warranty — ${w.daysLeft} day(s) left (ends ${formatDate(w.endDate)})` : `Out of warranty — Expired on ${formatDate(w.endDate)}`);
      document.getElementById('modalBody').innerHTML = `
        <h3>${escapeHtml(t.itemName)} — ${t.id}</h3>
        <div class="ticket-meta">Product ID: ${escapeHtml(t.productId||'—')} • Received: ${escapeHtml(t.receivedDate)}</div>
        <div style="margin-top:8px;color:#0b6;font-weight:600">${warrantyText}</div>
        <section class="timeline" style="margin-top:12px">
          <h4>Timeline</h4>${t.timeline.map(s=>`<div class="step"><div class="ticket-meta small">${new Date(s.at).toLocaleString()} — <strong>${escapeHtml(s.status)}</strong></div><div>${escapeHtml(s.note||'')}</div></div>`).join('')}
        </section>
      `;
      document.getElementById('modal').classList.remove('hidden');
    }

    function renderPublicStats(){
      const ticks = getAllTickets();
      document.getElementById('totalTickets').textContent = ticks.length;
      document.getElementById('inServiceCount').textContent = ticks.filter(t=>t.status==='In Service').length;
    }
  </script>
</body>
</html>